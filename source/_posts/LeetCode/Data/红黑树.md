---
title: 红黑树
categories:
  - 后端
  - 数据结构
tags:
  - 树
comments: true
toc: true
abbrlink: f89cb603
date: 2019-12-17 16:51:18
---

# 红-黑树的概念
上一篇二叉搜索树，二叉搜索树对于某个节点而言，其左子树的节点关键值都小于该节点关键值，右子树的所有节点关键值都大于该节点关键值。二叉搜索树作为一种数据结构，其查找、插入和删除操作的时间复杂度都为O(logn),底数为2。但是我们说这个时间复杂度是在平衡的二叉搜索树上体现的，也就是如果插入的数据是随机的，则效率很高，但是如果插入的数据是有序的，比如从小到大的顺序【10,20,30,40,50】插入到二叉搜索树中：

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1g9zu81htnyj309608d74y.jpg" width="300" height="300"></div>

从大到小就是全部在左边，这和链表没有任何区别了，这种情况下查找的时间复杂度为O(N)，而不是O(logN)。当然这是在最不平衡的条件下，实际情况下，二叉搜索树的效率应该在O(N)和O(logN)之间，这取决于树的不平衡程度。

**那么为了能够以较快的时间O(logN)来搜索一棵树，我们需要保证树总是平衡的（或者大部分是平衡的），也就是说每个节点的左子树节点个数和右子树节点个数尽量相等。红-黑树的就是这样的一棵平衡树，对一个要插入的数据项（删除也是），插入例程要检查会不会破坏树的特征，如果破坏了，程序就会进行纠正，根据需要改变树的结构，从而保持树的平衡。**

# 红黑树的特征和规则
- 节点都有颜色：在红-黑树中，每个节点的颜色或者是黑色或者是红色的。当然也可以是任意别的两种颜色，这里的颜色用于标记，我们可以在节点类Node中增加一个boolean型变量isRed，以此来表示颜色的信息。
- 在插入和删除的过程中，要遵循保持这些颜色的不同排列规则。规则如下：
  1.  每个节点不是红色就是黑色；
  2.  根节点总是黑色；
  3.  每个叶子节点都是黑色的空节点(叶子是NIL节点)；
  4.  每个红色节点的两个子节点都是黑色。(从每个叶子到根节点的所有路径上不能有两个连续的红色节点)
  5.  从任一节点到其叶子节点的所有路径上都包含相同数目的黑节点。

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga221iaf0ij30y10mxq4q.jpg" width="600" height="600"></div>

前四都能理解其意思吧，所以只解释下第五点，比如60这个节点，到其所有叶子节点的路径都只包含1个黑色节点：40和90。

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga222g3c2hj30vn0liacj.jpg" width="600" height="600"></div>

# 红-黑树的3种自我修正（改变节点颜色、左旋和右旋）
## 改变节点颜色

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1g9zxlagz64j30fr069jrp.jpg" width="600" height="600"></div>

新插入的节点为15，一般新插入颜色都为红色，那么我们发现直接插入会违反规则3，改为黑色却发现违反规则4。这时候我们将其父节点颜色改为黑色，父节点的兄弟节点颜色也改为黑色。通常其祖父节点50颜色会由黑色变为红色，但是由于50是根节点，所以我们这里不能改变根节点颜色。

## 右旋
首先要说明的是节点本身是不会旋转的，旋转改变的是节点之间的关系，选择一个节点作为旋转的顶端，如果做一次右旋，这个顶端节点会向下和向右移动到它右子节点的位置，它的左子节点会上移到它原来的位置。右旋的顶端节点必须要有左子节点。

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga0nnymiyag308d076te7.gif" width="400" height="400"><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga226xhrqkj30fo0ag0wy.jpg" width="400" height="400"></div>

以图中红色节点为中心，中心节点为右子节点替代，而自己成为它的左子节点，同时节点b作为pivot的有子节点(至于为什么是右子节点，b原本就在pivot的右子树上，所以肯定大于pivot).

## 左旋
同左旋转，中心点顺时钟旋转，成为其原来左子节点的右子节点，原来左子节点的右子节点则成为原中心点的左子节点。

<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga0nzwc2vlg309506pjxv.gif" width="400" height="400"><img src="https://ws1.sinaimg.cn/large/007lnJOlgy1ga22cq8g9oj30fv0an78g.jpg" width="400" height="400"></div>

# 红黑树的插入
### 情况1：空树
直接插入，直接作为根节点，同时由于性质1的约束，通过变色op变为黑色即可。
<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga22zdntxgj30k60auq39.jpg"/></div>

### 情况2：插入节点父节为黑色
不违反任何性质，无需做任何修改。
<div align=center><img src="http://ws1.sinaimg.cn/large/007lnJOlgy1ga230akx0yj30mr0dct96.jpg"/></div>

### 情况3：插入节点的父节点为红色，父节点为父父节点的左孩子，父父节点的右孩子为黑色，插入节点为左孩子(或者父节点为父父节点的右孩子，父父节点的左孩子为黑色，插入节点为右孩子)。

这是一种插入节点和父节点在一个方向上的情况(例如父节点为左孩子，插入节点也为左孩子)和情形5相反

父节点 及 父父节点变色，再进行左/右旋转， 具体左还是右看你插入的节点的父节点是左子树还是右子树，图例为左子树。

此处 : 变色 - > 右旋转
<div align=center><img src="http://ww1.sinaimg.cn/large/007lnJOlgy1ga232cvg7lj30t50aqaax.jpg"/></div>

### 情况4：插入节点父节点为红色，父父节点的左/右孩子为红色
先将父节点和父父节点右孩子变黑，父父节点变红，然后将父节点当做新插入的红色节点一样递归向上进行平衡红黑树性质操作。 若父节点为根节点直接变父节点为黑色即可.

此处 : 变色 -> 变色
<div align=center><img src="http://ww1.sinaimg.cn/large/007lnJOlgy1ga232cvg7lj30t50aqaax.jpg"/></div>

### 情况5：插入节点的父节点为红色，父节点为父父节点的左孩子，父父节点的右孩子为黑色，插入节点为右孩子(或者父节点为父父节点的右孩子，父父节点的左孩子为黑色，插入节点为左孩子)
和情形3类比是一种反向情况，这种情况进行两次旋转，
先左/右旋转，旋转后变成了情形3，接着按情形3变换即可。

此处 ：左旋转 -> 变色 -> 右旋转
<div align=center><img src="http://ww1.sinaimg.cn/large/007lnJOlgy1ga23otwmq8j31fx0da0v3.jpg"/></div>