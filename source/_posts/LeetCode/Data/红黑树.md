---
title: 红黑树
categories:
  - 后端
  - 数据结构
tags:
  - 树
comments: true
toc: true
abbrlink: f89cb603
date: 2019-12-17 16:51:18
---

# 红-黑树的概念
上一篇二叉搜索树，二叉搜索树对于某个节点而言，其左子树的节点关键值都小于该节点关键值，右子树的所有节点关键值都大于该节点关键值。二叉搜索树作为一种数据结构，其查找、插入和删除操作的时间复杂度都为O(logn),底数为2。但是我们说这个时间复杂度是在平衡的二叉搜索树上体现的，也就是如果插入的数据是随机的，则效率很高，但是如果插入的数据是有序的，比如从小到大的顺序【10,20,30,40,50】插入到二叉搜索树中：

![1.png](https://ws1.sinaimg.cn/large/007lnJOlgy1g9zu81htnyj309608d74y.jpg)

从大到小就是全部在左边，这和链表没有任何区别了，这种情况下查找的时间复杂度为O(N)，而不是O(logN)。当然这是在最不平衡的条件下，实际情况下，二叉搜索树的效率应该在O(N)和O(logN)之间，这取决于树的不平衡程度。

**那么为了能够以较快的时间O(logN)来搜索一棵树，我们需要保证树总是平衡的（或者大部分是平衡的），也就是说每个节点的左子树节点个数和右子树节点个数尽量相等。红-黑树的就是这样的一棵平衡树，对一个要插入的数据项（删除也是），插入例程要检查会不会破坏树的特征，如果破坏了，程序就会进行纠正，根据需要改变树的结构，从而保持树的平衡。**

# 红黑树的特征和规则
- 节点都有颜色：在红-黑树中，每个节点的颜色或者是黑色或者是红色的。当然也可以是任意别的两种颜色，这里的颜色用于标记，我们可以在节点类Node中增加一个boolean型变量isRed，以此来表示颜色的信息。
- 在插入和删除的过程中，要遵循保持这些颜色的不同排列规则。规则如下：
  1.  每个节点不是红色就是黑色；
  2.  根节点总是黑色；
  3.  如果节点是红色的，则它的子节点必须是黑色的，(也就是从每个叶子到根的所有路径上不能有两个连续的红色节点)；
  4.  从根节点到叶节点或空子节点的每条路径，必须包含相同数目的黑色节点（即相同的黑色高度）

注意：新插入的节点颜色总是红色的，这是因为插入一个红色节点比插入一个黑色节点违背红-黑规则的可能性更小，原因是插入黑色节点总会改变黑色高度（违背规则4），但是插入红色节点只有一半的机会会违背规则3（因为父节点是黑色的没事，父节点是红色的就违背规则3）。另外违背规则3比违背规则4要更容易修正。当插入一个新的节点时，可能会破坏这种平衡性，那么红-黑树是如何修正的呢？

# 红-黑树的3种自我修正（改变节点颜色、左旋和右旋）
## 改变节点颜色

![2.png](https://ws1.sinaimg.cn/large/007lnJOlgy1g9zxlagz64j30fr069jrp.jpg)

新插入的节点为15，一般新插入颜色都为红色，那么我们发现直接插入会违反规则3，改为黑色却发现违反规则4。这时候我们将其父节点颜色改为黑色，父节点的兄弟节点颜色也改为黑色。通常其祖父节点50颜色会由黑色变为红色，但是由于50是根节点，所以我们这里不能改变根节点颜色。

## 右旋
首先要说明的是节点本身是不会旋转的，旋转改变的是节点之间的关系，选择一个节点作为旋转的顶端，如果做一次右旋，这个顶端节点会向下和向右移动到它右子节点的位置，它的左子节点会上移到它原来的位置。右旋的顶端节点必须要有左子节点。
![3.gif](https://ws1.sinaimg.cn/large/007lnJOlgy1ga0nnymiyag308d076te7.gif)

## 左旋
左旋的顶端节点必须要有右子节点。
![5.gif](https://ws1.sinaimg.cn/large/007lnJOlgy1ga0nzwc2vlg309506pjxv.gif)